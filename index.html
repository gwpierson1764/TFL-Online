<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tabletop Football League 2.0</title>
  <style>
    /* keep your full CSS here (unchanged for now) */
  </style>
</head>
<body>
  <!-- your full HTML from prototype goes here -->
  
  <!-- Firebase + Game Script -->
  <script type="module">
    // ===== Firebase Setup =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { 
      getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ðŸ”‘ Replace with your Firebase project config
    const firebaseConfig = {
      apiKey: "AIzaSyBORp6VuavYwFin5toiHlFIx4VF7lBl5LU",
      authDomain: "tfl-online.firebaseapp.com",
      projectId: "tfl-online",
      storageBucket: "tfl-online.firebasestorage.app",
      messagingSenderId: "512894669431",
      appId: "1:512894669431:web:6c7d8fe94b7c5c26df6c72",
      measurementId: "G-7ZLZKC94BG"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== Authentication =====
    let playerId = null;
    let gameId = "demoGame1"; // later: create/join unique IDs

    signInAnonymously(auth).then(user => {
      playerId = user.user.uid;
      console.log("Signed in as", playerId);
      initFirestoreGame();
    });

    // ===== Firestore Sync =====
    async function initFirestoreGame() {
      const gameRef = doc(db, "games", gameId);
      const gameSnap = await getDoc(gameRef);

      if (!gameSnap.exists()) {
        // create game doc
        await setDoc(gameRef, {
          phase: "play-selection",
          quarter: 1,
          down: 1,
          distance: 10,
          ballPosition: 20,
          score: { player: 0, opponent: 0 },
          momentum: { player: 0, opponent: 0 }
        });
      }

      // subscribe to game state changes
      onSnapshot(gameRef, (docSnap) => {
        if (docSnap.exists()) {
          const data = docSnap.data();
          console.log("Game updated:", data);
          // TODO: call your update functions to redraw UI
          syncUIWithGame(data);
        }
      });
    }

    // ===== Example update function =====
    async function updateGameField(newState) {
      const gameRef = doc(db, "games", gameId);
      await updateDoc(gameRef, newState);
    }

    // ===== Hook into your prototype =====
    function syncUIWithGame(data) {
      // Example: update quarter + down UI
      document.getElementById("quarter").textContent = data.quarter + "st";
      document.getElementById("downDistance").textContent = 
        `${data.down}${getOrdinalSuffix(data.down)} & ${data.distance}`;
      document.getElementById("ballPosition").textContent = `Own ${data.ballPosition}`;
      document.getElementById("score").textContent = 
        `${data.score.player}-${data.score.opponent}`;
    }

    function getOrdinalSuffix(num) {
      const suffixes = ['th','st','nd','rd'];
      const v = num % 100;
      return suffixes[(v-20)%10] || suffixes[v] || suffixes[0];
    }

    // Example: when resolvePlay() runs in your prototype,
    // call updateGameField({ down: newDown, ballPosition: newBall })
  </script>
  
  <script>
    // Keep your existing prototype game logic (resolvePlay, rollAllDice, etc.)
    // but at the end of each update, ALSO call updateGameField() with the new state
  </script>
</body>
</html>
